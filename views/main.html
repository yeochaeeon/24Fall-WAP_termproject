{% extends 'layout.html' %}
{% block content %}
<div class="timeline">
  {% if user %}
  <div class="studies">
    <h2 style="text-align: center">ğŸ“ê°œì„¤ëœ ìŠ¤í„°ë””ğŸ“</h2>
    {% if studylist and studylist.length > 0 %}
    {% for study in studylist %}
    <div class="study">
      <div class="study-title" style="font-size: large; margin-bottom: 5px;"><strong>{{ study.title }} ìŠ¤í„°ë””</strong></div>
      <div class="studyDescription">
        <div class="studyDescription1">
          <div class="study-author"><strong>ìŠ¤í„°ë””ì¥</strong> : {{ study.createdBy.nick }}</div>
          <div class="currentMember"><strong>í˜„ì¬ ì¸ì›</strong>: {{ study.currentMember }}ëª…</div>
          <div class="maxMember"><strong>ìµœëŒ€ ì¸ì›</strong> : {{ study.maxMember }}ëª…</div>
        </div>
        <div class="studyDescription2">
        <div class="study-actions" style="margin-top:10px;">
          {% if study.isOwner %}
          <p>â­ë‚´ê°€ ê°œì„¤í•œ ìŠ¤í„°ë””â­</p>
          <a href="/study/{{ study.id }}" class="btn">ì…ì¥í•˜ê¸°</a>
          {% elif study.isMember %}
          <a href="/study/{{ study.id }}" class="btn">ì…ì¥í•˜ê¸°</a>
          {% else %}
          <form action="/study/join" method="POST" style="display: inline;">
            <input type="hidden" name="studyId" value="{{ study.id }}">
            <button type="submit" class="btn" style="color:coral">ê°€ì…í•˜ê¸°</button>
          </form>
          {% endif %}
        </div>
        </div>
      </div>
    </div>
    {% endfor %}
    {% else %}
    <h3 style="text-align: center">ë“±ë¡ëœ ìŠ¤í„°ë””ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</h3>
    {% endif %}
  </div>
  {% else %}
  <h2>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!</h2>
  {% endif %}
</div>

{% endblock %}

{% block script %}
<script>
  // URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì½ê¸°
  const urlParams = new URLSearchParams(window.location.search);
  const successMessage = urlParams.get('success');
  const errorMsg = urlParams.get(('error'));
  if (successMessage) {
    alert(`${successMessage} ìŠ¤í„°ë”” ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤`);
    // ì„±ê³µ ë©”ì‹œì§€ê°€ ë°˜ë³µì ìœ¼ë¡œ ëœ¨ì§€ ì•Šë„ë¡ URLì—ì„œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì œê±°
    history.replaceState(null, '', window.location.pathname);
  }
  if (errorMsg === 'maxMembers'){
    alert('ìµœëŒ€ ì¸ì›ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë” ì´ìƒ ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    // ì¿¼ë¦¬ì˜ ì—ëŸ¬íŒŒë¼ë¯¸í„° ì—†ì• ê¸°
    history.replaceState(null, '', window.location.pathname);
  }
  document.querySelector('#study-form')?.addEventListener('submit', function (event) {
    const title = document.querySelector('#title').value.trim();
    const maxMembers = document.querySelector('#maxMembers').value;

    if (!title || !maxMembers) {
      event.preventDefault();
      alert('ìŠ¤í„°ë”” ì œëª©ê³¼ ìµœëŒ€ ì¸ì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    }
  });
</script>
{% endblock %}



